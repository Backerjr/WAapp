- name: Try to set package visibility (detect org vs user)
  uses: actions/github-script@v6
  with:
    github-token: ${{ secrets.GH_PAGES_PAT }}
    script: |
      const owner = context.repo.owner;
      const pkg = 'rozmowa';
      let isOrg = false;
      try {
        await github.request('GET /orgs/{org}', { org: owner });
        isOrg = true;
      } catch (err) {
        core.info(`${owner} is not an org (or cannot be queried): ${err.message}`);
      }
      if (isOrg) {
        try {
          await github.request('PUT /orgs/{org}/packages/container/{package_name}/visibility', {
            org: owner,
            package_name: pkg,
            data: { visibility: 'public' }
          });
          core.info('Set org package visibility to public');
          return;
        } catch (e) {
          core.warning(`Failed to set org package visibility: ${e.message}`);
        }
      }
      try {
        await github.request('PUT /user/packages/container/{package_name}/visibility', {
          package_name: pkg,
          data: { visibility: 'public' }
        });
        core.info('Set user package visibility to public');
      } catch (e) {
        core.warning(`Failed to set user package visibility: ${e.message}`);
      }
