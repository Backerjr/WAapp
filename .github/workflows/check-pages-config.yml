name: Check Pages Configuration

on:
  workflow_dispatch:

permissions:
  contents: read
  pages: read

jobs:
  check-pages-status:
    name: Check GitHub Pages Configuration
    runs-on: ubuntu-latest
    steps:
      - name: Check current Pages configuration (read-only)
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            try {
              const response = await github.rest.repos.getPages({
                owner: context.repo.owner,
                repo: context.repo.repo
              });
              
              const isCorrectlyConfigured = response.data.source.branch === 'gh-pages' && 
                                          response.data.source.path === '/';
              
              core.info(`📄 Current Pages Configuration:`);
              core.info(`   Source branch: ${response.data.source.branch}`);
              core.info(`   Source path: ${response.data.source.path}`);
              core.info(`   Status: ${response.data.status}`);
              core.info(`   URL: ${response.data.html_url}`);
              core.info(`   Build type: ${response.data.build_type}`);
              core.info(`   Public: ${response.data.public}`);
              
              if (isCorrectlyConfigured) {
                core.info('✅ GitHub Pages is correctly configured with gh-pages branch');
                core.info('   No changes needed - configuration is optimal');
              } else {
                core.warning('⚠️ Pages configuration differs from expected setup');
                core.info('   Expected: branch=gh-pages, path=/');
                core.info(`   Actual: branch=${response.data.source.branch}, path=${response.data.source.path}`);
                core.info('   Manual adjustment may be needed through repository Settings > Pages');
              }
              
            } catch (error) {
              if (error.status === 404) {
                core.warning('⚠️ GitHub Pages is not configured for this repository');
                core.info('📋 To enable Pages:');
                core.info('   1. Go to repository Settings > Pages');
                core.info('   2. Select "Deploy from a branch"');
                core.info('   3. Choose "gh-pages" branch and "/ (root)" folder');
                core.info('   4. Click Save');
              } else {
                core.error(`❌ Failed to check Pages configuration: ${error.message}`);
                throw error;
              }
            }

      - name: Provide configuration summary
        run: |
          echo "::notice title=Pages Check Complete::This workflow only checks GitHub Pages configuration and does not make changes."
          echo "::notice title=Manual Configuration::If changes are needed, please use repository Settings > Pages to configure manually."